# Fixes

## Incorrect behaviour on archive subsystem

A LOT of things were broken. Now it's (maybe) working correctly.

## Other fixes

- Documentation typos
- Incorrect/missing behaviour in `TypeInfo`

# Additions

## UTF-8 & UTF-32 Support!

Via `UTF8String` (alias for `UTF::UString<8>`) and `UTF32String` (`UTF::UString<32>`), respectively.

Implemented similarly to rust's (i.e. it stores the 32-bit *unicode scalar value* for a given character), with a few extra quirks.

Although each unicode format has its own character type (`UTF8Char` (`UTF::UChar<8>`) and `UTF32Char` (`UTF::UChar<32>`)),
they can be seamlessly converted between each other without any issue.
Essentially, this separation exists solely to make implementation of UTF strings easier.

> [!caution]
> **You should *never* read/write/manipulate/etc. the `UTF\*String`'s contents byte-by-byte!**
>
> Due to its implementation,
> the highest four bits of the 32-bit scalar
> are used for encoding/decoding optimization purposes!

As for why?

**Advantages:**

- Allows seamless conversion between both formats (without needing constant decoding-and-encoding);
- **Per-code-point iteration!**
- Seamless string per-code-point manipulation (split, substring, replace, etc.).

**Disadvantages:**

- Requires way more storage space for any text;
	- If you only need ASCII, then the default `String` is plenty enough.

## Lexers & parsers!

## Custom data class!

## New data exchange format support: FLOW!

Stands for **F**ast **L**azy **O**bject **W**riting.

Any JSON file is also a valid FLOW file, but the opposite is not.

Differences:
- In FLOW, separators are not needed, and are discarded.
- Line comments (//) & block comments (/* ... */).
- Strings & keys can be single-quote, double-quote, or unquoted (but composed only of alphanumeric characters or underscore).
- Builtin binary support (via a byte string);

Example:

```
{
  null_v null
  bool_v false
  int_v -1
  uint_v 1
  unq_str string_with_no_quotes
  sq_str 'String with single quotes'
  dq_str "String with double quotes"
  ml_str "
    Both string types
	can also be
	multi-line
  "
  byte_str #""
  array_v [1 2 4 8 16 32]
  object_v {
    key1 "value 1"
    key2 {
      subkey1 "value 1"
	  "subkey2" "value 2"
    }
    "key3" "value 3"
  }
}
```

## Other Additions

- `Tree` namespace: For tree data structures.
	- `Tree::AVL`: Adelson-Velsky and Landis tree.
- `Ranges` namespace: For operations on ranges of values.
- `StateMachine<TState>`: State machine with path priority.
- `TreeMap`: Tree-based associative container.
- `HashMap`: Associative container with hashed keys.
- `ABoss` → `getCurrentAct()`.
- For music: `crossFadeInto()`.
- `FontData` → emphasis font.
- Added `UTF8Label`: Text label for UTF-8 text.
	- Along with `UTF8TextData`: Ditto old `TextData`, but for UTF-8 text.
- `CTL::List` → `replace()`.

# Non-breaking changes

## Other non-breaking changes

- Changed how `APeriodic` handles callbacks.

# Breaking changes

## Text display refactor

- `FontData` → Font images are now stored in `FontData::Faces` structure.
- Changes relating to `Label`:
	- Now inherits `Base::ALablel`
	- Renamed to `CharLabel`
- Changes relating to `TextData`:
	- Renamed to `CharTextData`
	- Now an analog for `CharLabel<String>::ContentType` (AKA `Base::TextData<String>`)
- `Label` is now a template for auto-deducing label type based on string type
	- Use `String` for `CharLabel`
	- Use `UTF8String` for `UTF8Label`

## Complete `Audio` subsystem refactor

- Now uses `miniaudio` as a backend, instead of `SDL_Mixer`

## Complete `NotificationServer` subsystem refactor

- `NotificationServer` → `ANotifiable`
	- Now objects must inherit from it to receive notifications

## For game extensions: All text display is now done via `UTF8Label`

## Other breaking changes

- Changed how `RenderServer` handles callbacks
	- It is now via an interface `RenderServer::IEntity`
- Changed `arcgen` keyfile output
- `list.hpp` → moved to inside `lists/`
- `map.hpp` → moved to inside `map/`
	- `BaseSimpleMap` → renamed to `BaseListMap`
	- `SimpleMap` → renamed to `ListMap`
	- `SimpleDictionary` → renamed to `ListDictionary`
	- Anything `SimpleMap` related has been renamed appropriately to match `ListMap`
	- `SimpleMap` → `PairType` : `KeyType` is now const
- `MX::destruct` → returns `ref<T>` (to destructed memory)
- Changed how `tryGet()` is implemented on `JSON::JSONView`
	- Now extension is via creating a specialization of `JSON::Impl::Accessor<T>`
		- For examples, see implementations included in the header
- `atoi`, `atof`: "Implicit Octals" (octals whose prefix are only `0`) are now considered invalid, and are treated as decimal values instead