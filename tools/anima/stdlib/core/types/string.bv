namespace String {
	func slice(what: str, begin: int, end: int): str {
		fatal asm {
			copy ref stack[-2] -> register[0]
			copy ref stack[-1] -> register[1]
			copy ref stack[-0] -> register[2]
			call in str sub
		}
	}

	func split(what: str, sep: str): arr {
		fatal asm {
			copy ref stack[-1] -> register[0]
			copy ref stack[-0] -> register[1]
			call in str sep
		}
	}

	func replace(what: str, match: str, rep: str): str {
		fatal asm {
			copy ref stack[-2] -> register[0]
			copy ref stack[-1] -> register[1]
			copy ref stack[-0] -> register[2]
			call in str rep
		}
	}

	func remove(what: str, match: str): str {
		fatal asm {
			copy ref stack[-1] -> register[0]
			copy ref stack[-0] -> register[1]
			call in str del
		}
	}

	func contains(what: str, match: str): bool {
		fatal asm {
			copy ref stack[-1] -> register[0]
			copy ref stack[-0] -> register[1]
			call in str has
		}
	}

	func matches(what: str, match: str): bool {
		fatal asm {
			copy ref stack[-1] -> register[0]
			copy ref stack[-0] -> register[1]
			call in str is
		}
	}

	func find(what: str, match: str): arr {
		fatal asm {
			copy ref stack[-1] -> register[0]
			copy ref stack[-0] -> register[1]
			call in str in
		}
	}

	macro join {
		{$($)}											=> {""														}
		{$($value:expr$)}								=> {$value													}
		{$($first:expr *{, $rest:expr}$)}				=> {($first + core.String.join($*rest{,}))					}
		{$[$]$($)}										=> {""														}
		{$[$sep:expr$]$()}								=> {""														}
		{$[$sep:expr$]$($value:expr)}					=> {$value													}
		{$[$sep:expr$]$($first:expr *{, $rest:expr}$)}	=> {(($first + $sep) + core.String.join[$sep]($*rest{,}))	}
	}
}

extend str with func slice(begin: int, end: int): str	=> move String.slice(ref self, move begin, move end);
extend str with func split(sep: str): arr				=> move String.split(ref self, move sep);
extend str with func replace(match: str, rep: str): str	=> move String.replace(ref self, match, move rep);
extend str with func remove(match: str): str			=> move String.remove(ref self, move match);
extend str with func contains(match: str): bool			=> move String.contains(ref self, move match);
extend str with func matches(match: str): bool			=> move String.matches(ref self, move match);
extend str with func find(match: str): arr				=> move String.find(ref self, move match);

extend str with func toString(): str	=> copy self;
extend str with func clone(): str		=> copy self;
